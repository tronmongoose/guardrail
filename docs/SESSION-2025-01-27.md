# GuideRail — Session Summary (Jan 27, 2025)

## What was built

Full MVP scaffold for GuideRail: an instructor-led program platform where creators turn YouTube content into structured, purchasable learning journeys.

### Architecture

```
guide.rail/
├── apps/web/              Next.js 15 App Router + Tailwind + Clerk + Stripe
│   ├── app/               Pages & API routes
│   ├── lib/               Prisma client, auth helpers, Stripe, slug util
│   ├── prisma/            Schema (12 models, Postgres)
│   └── __tests__/         Vitest (19 tests, all passing)
├── packages/shared/       Zod schemas, TypeScript types, YouTube URL parser
├── packages/ai/           HF embeddings, k-means clustering, LLM adapter (stub/anthropic/openai)
└── docs/                  This file, excluded features, plan file
```

### Database (Prisma, pushed to local Postgres on port 5433)

12 models: User, Program, Week, Session, Action, YouTubeVideo, ProgramDraft, Entitlement, LearnerProgress, Embedding, ClusterAssignment, Cohort (stub)

### Pages — all rendering locally

| Route | Status | Notes |
|-------|--------|-------|
| `/` | Working | Neon dark theme, animated hero, how-it-works, stats, CTAs |
| `/dashboard` | Working | Creator program list, "New Program" button, dev mock user |
| `/programs/[id]/edit` | Working | Client component — details form, YouTube paste, AI generate, structure preview, publish |
| `/p/[slug]` | Working | Public sales page (needs a published program to see content) |
| `/learn/[programId]` | Working | Learner timeline with weekly drip, action completion, YouTube embed, reflections |

### API Routes — all wired

| Endpoint | Purpose |
|----------|---------|
| `POST /api/programs/create` | Create new program, redirect to editor |
| `GET/PATCH /api/programs/[id]` | Read/update program |
| `POST /api/programs/[id]/videos` | Add YouTube video via URL (oEmbed metadata fetch) |
| `POST /api/programs/[id]/auto-structure` | HF embeddings → k-means clustering → store |
| `POST /api/programs/[id]/generate` | LLM adapter → ProgramDraft JSON → zod validate → persist structure |
| `POST /api/programs/[id]/publish` | Create Stripe product/price, set published |
| `POST /api/checkout/[programId]` | Stripe Checkout or free enrollment |
| `POST /api/webhooks/stripe` | Webhook → create Entitlement |
| `POST /api/progress` | Mark action complete + store reflection |

### AI Pipeline

- **HF Embeddings**: `sentence-transformers/all-MiniLM-L6-v2` via Inference API, batched (16), retry/backoff
- **Clustering**: Deterministic k-means with fixed-seed init, configurable k
- **LLM**: Provider-agnostic wrapper (stub/anthropic/openai), zod validation, retry-repair loop
- **Stub mode**: Works locally with zero API keys — generates deterministic program structure

### Key Design Decisions

- Clerk, Stripe, and HF are all optional for local dev — app boots and renders without any API keys
- Dev mock user auto-created when Clerk is not configured
- `LLM_PROVIDER=stub` is the default — no LLM key needed to test the generate flow
- Embeddings stored as JSONB (note: migrate to pgvector for production scale)
- Program structure: Program → Weeks → Sessions → Actions (normalized, not JSON blob)

### Tests (19/19 passing)

- YouTube URL parser (7 tests): standard URLs, short URLs, mobile, edge cases
- Clustering determinism (5 tests): empty input, single item, multi-run stability, k parameter, uniqueness
- Schema validation (7 tests): valid draft, missing fields, invalid enums, optional fields

---

## What works end-to-end (honest assessment)

**Fully working locally:**
- Landing page renders with neon theme
- Dashboard renders, creates dev user in DB
- Program editor UI loads and displays forms
- Tests pass

**Works but untested in browser flow (no API keys set):**
- YouTube URL paste → oEmbed fetch → store (API route exists, needs manual test)
- AI auto-structure → generate → persist (API routes exist, stub mode works)
- Stripe checkout → webhook → entitlement (routes exist, needs Stripe keys)
- Learner timeline (needs a program with structure + entitlement to view)

**Not working / not built:**
- No real Clerk auth flow (mock user only)
- No Stripe keys = checkout/publish will throw
- No HF token = auto-structure will 502
- Dashboard still uses old light theme (clashes with dark body)
- No inline editing of individual actions/sessions in the editor
- No weekly drip logic (enrollment date vs week number comparison)
- No sign-in/sign-up pages

---

## Pick-up Plan (next session)

### Priority 1: Make the full creator flow work end-to-end
1. **Set up Clerk** — create dev instance, add keys to `.env`, verify sign-in/sign-up
2. **Theme the dashboard + editor** — match neon dark theme from landing page
3. **Test YouTube paste flow** — paste a real URL in the editor, confirm thumbnail + title appear
4. **Test AI generate flow** — with stub mode first, then with real HF token
5. **Test publish flow** — set up Stripe test keys, publish a program, verify sales page

### Priority 2: Make the learner flow work end-to-end
6. **Test checkout** — buy a program (or enroll free), verify entitlement created
7. **Test learner timeline** — access `/learn/[programId]`, complete actions, write reflections
8. **Implement weekly drip** — compare enrollment date to `weekNumber`, gate future weeks

### Priority 3: Polish
9. **Inline action editing** — let creators edit individual action titles, instructions, prompts
10. **Add sign-in/sign-up pages** — Clerk components at `/sign-in` and `/sign-up`
11. **Mobile testing** — verify all pages work on phone viewport
12. **Error states** — loading spinners, empty states, error messages for failed API calls

### Priority 4: Production prep
13. **Deploy to Vercel** — set env vars, verify build
14. **pgvector migration** — replace JSONB embedding storage
15. **Real LLM provider** — switch from stub to anthropic/openai, test with real content
16. **Stripe Connect** — creator payouts (future)

### Backlog (explicitly excluded from MVP)
- Video remix/re-edit
- Community features
- Cohort UI
- Advanced pacing (unlock_on_completion)
- See `docs/EXCLUDED_FEATURES.md`
